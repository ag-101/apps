<h3><strong><%= @apps_construct.name %></strong> <%= t('text.submissions').downcase %></h3>

<%= paginate @submissions %>

<% if @submissions.count > 0 %>
<div class="panel panel-default">
	<div class="panel-heading">
		<h3 class="panel-title">
			<div class="row">
				<div class="col-sm-2"><%= t('text.submitted') %></div>
				<div class="col-sm-2"><%= t('text.submitted_by') %></div>
				<div class="col-sm-2"><%= t('text.submission') %></div>
				<div class="col-sm-2"><%= t('text.workflow') if @apps_construct.workflow %></div>
				<div class="col-sm-4"><%= t('text.status') if @apps_construct.workflow %></div>
			</div>
		</h3>
	</div>
	<div class="panel-body">
<% @submissions.each do |submission| %>

	<% row_class = '' %>
	
	<% 	if submission.workflow_contents.last 
			case submission.workflow_contents.last.status 
			when 'approved'
				row_class = 'alert-success'
			when 'pending'
				row_class = 'alert-warning'
			when 'rejected'
				row_class = 'alert-danger'
		 	end
		 	highlight_stage = submission.workflow_contents.last.workflow_stage.stage
		 	highlight_stage = highlight_stage + 1 unless submission.workflow_contents.last.status == 'pending'
	end%>

	<div class="row <%= row_class %>">
		<div class="col-sm-2">
			<%= submission.created_at.to_formatted_s(:long_ordinal)  %>
		</div>
		<div class="col-sm-2">
			<%= submission.created_by.name %>
		</div>
		<div class="col-sm-2">
			<div class="btn-group">
				<%= link_to t('text.view'), app_form_submission_path(submission.construct.app, submission.construct, submission), :class=>'btn btn-default btn-xs' %>
			</div>
		
			<div class="btn-group">	
				<% if submission.workflow_contents and submission.workflow_contents.last and submission.workflow_contents.last.workflow_stage.send_to == current_user and submission.workflow_contents.last.status == 'pending' %>
					<%= link_to 'Approve', approve_app_form_submission_workflow_content_path(@app, submission.construct, submission, submission.workflow_contents.last), :class=>'btn btn-success btn-xs' %>
					<%= link_to 'Reject', reject_app_form_submission_workflow_content_path(@app, submission.construct, submission, submission.workflow_contents.last), :class=>'btn btn-danger btn-xs' %>
				<% end %>	
			</div>		
		</div>
		
		<div class="col-sm-2">
			<%= link_to submission.construct.workflow.name, app_workflow_path(@app, submission.construct.workflow, :highlight => highlight_stage || 0) if submission.construct.workflow %>
		</div>
		
		<div class="col-sm-4">
			<%= render 'workflow_status', :submission => submission, :full_workflow => false if submission.construct.workflow == 2 and submission.workflow_contents %>
		</div>
	</div>
<% end %>
</div>
</div>
<% else %>
	<%= t('text.no_responses')%>
<% end %>
<%= paginate @submissions %>
<br/>
<%= button_icon_link 'chevron-left', t('text.submissions_list'), app_submissions_select_path(@app) %>


