<% pages = JSON.parse @submission.construct.content %>
<% response = JSON.parse @submission.content %>

<h3><strong><%= @submission.construct.name %></strong> response by <strong><%= @submission.created_by.name %></strong>, <%= @submission.created_at.to_formatted_s(:long_ordinal)  %></h3>


<div class="form-horizontal form_show">
	<% pages.each_with_index do |(page, page_contents), index| %>
		<div class="page panel <%= 'panel-default' unless pages.count <= 1 %>" id="page_<%= index+1 %>">
			<%= "<div class='panel-heading'><h3 class='panel-title'><strong>#{ index+1 }</strong>. #{ page.split(":", 2)[1] }</h3></div>".html_safe unless page.blank? or pages.count <= 1 %>
			<div class="panel-body">
			<% retractions = 0 %>
			<% page_contents.each_with_index do |page, page_index|%>
				<% page.each do |item_type, properties| %>
					<% properties['response'] = response["page_#{index+1}"][(page_index - retractions)][item_type] unless item_type == 'page_content' %>
					<% properties['additional_options'] = response["page_#{index+1}"][(page_index - retractions)]['additional_options'] unless item_type == 'page_content' %>
					<% retractions = retractions +1 if item_type == 'page_content'%>
					<%= render "apps/forms/form_builder/#{item_type}.html.erb", :properties => properties %>
				<% end %>
			<% end %>
			</div>
		</div>
	<% end %>
</div>